---
date: 2016-07-23 22:00
status: public
title: '自动布局（Auto Layout）介绍'
tags: APP, 翻译
---

> 原文来自：[Introduction to Auto Layout](http://www.appcoda.com/introduction-auto-layout/)

编者按：如果你已经下载过 Xcode 6 Beta 并且已经在那上面溜过一圈，有一样相信你不会没发现的改变：Interface Builder（界面构建）的那些变化。默认的 View Controller 更加宽阔，看起来并不像是 iPhone5 的大小。当你放置一个按钮在界面中间然后运行程序，你会发现它看起来有点糟糕——按钮并没有正确地显示在界面中央。

<!--more-->

所以这其中有什么出错了吗？你又该怎么使按钮布局正确？这个答案就是自动布局（Auto Layout）。Auto Layout 是一个根据限制（constraint-based）来布局的方法。其允许开发者创建一个自适应的界面来做到合适地在不同屏幕大小和旋转方向之间调整。我们很少在我们的教程之中谈到 Auto Layout。一个初学者觉得它很难学因而避免去使用它。从 Xcode 6 开始，你应该学习并爱上 Auto Layout。苹果公司将在这个这个秋天推出 4.7 英寸和 5.5 英寸的 iPhone 6。如果没有 Auto Layout，你可能非常难开发出一款适应多种不同屏幕大小的 App。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-featured.png)

所以从本周起，我们将会推出一系列关于 Auto Layout 的文章。我们将从基础开始讲起。

下面带来 Ziad 为我们讲解的 Auto Layout 介绍。

我明白现在有挺多开发者不喜欢 Auto Layout，可能因为它相当的新颖而幼稚或者说它一开始难以上手。但请相信我，一旦你熟悉去使用它，它将成为你编写 app 时不可或缺的最佳工具。在这篇教程中，我将给你带来最简洁易懂的 Auto Layout 上手介绍。

## Why Auto Layout？

Auto Layout 是一种通过定义因素间关系、帮助开发者创建用户界面（User Interface）的方法。它提供了一种灵活并强大的方法来描述视图（view）和控件（UI controls)之间如何彼此联系。通过使用 Auto Layout，你可以运用种类多样的自定义，十分友好地控制布局，做出完美的界面。

Auto Layout 是一个非常棒的工具，它做到了早期科技从来没想过的的事情。从处理创建视图间的相互关系的表现（原文：edge case)来看，Auto Layout 表现出巨大的能力。初次之外，Auto Layout 还和苹果的多数令人激动的 API 和谐兼容，包括动画（animations）、动作效果（motion effects）和子画面（sprites）。

Ok，现在我将示范一下 Auto Layout，希望能帮助你明白为什么 Auto Layout 如此重要。在故事板（storyboard）中，放置一个按钮（button）在视图的中央。在虚拟机上用 iPhone Retina（3.5 英寸）和 iPhone Retina（4 英寸）运行程序。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-press-me-center.jpg)

你会得到以上的运行结果。可以看到，在 3.5 英寸的 iPhone 上运行的程序中按钮并没有正确的放置在中间。

这其中出了什么问题？

如果没有 Auto Layout，我们放置在 storyboard 上的 UI controls（如 button）会被固定在位置上。换句话说，我们「强制编写」了控件的 frame origin。例如，「Press Me」这个按钮的 frame origin 会被设置为（104，255）。因此，无论是在 3.5 还是 4 英寸的 iPhone 上，iOS 都会将控件绘制在如上所述的位置上。这就能解释为什么「Press Me」按钮不能在 3.5 英寸上正确显示，因为屏幕的高度是不同的。

## 在 Interface Builder 中如何使用 Auto Layout

在解决上述例子的问题之前，我们先简单的了解一下 Interface Builder，理解 Auto Layout 是怎么被应用的。

首先新建一个工程（project），选择  Single View Application iOS app view。在 project 选项中，选择 Device 为 iPhone，保存 project，打开 storyboard。能够在右下角看到一个菜单。这些按钮便关系到你的 Auto Layout。你可以使用 Align（对齐）、Resizing（尺寸）、Pin（固定）、以及 Issues（事件）。

* Align：创建对齐约束，例如将两个视图左对齐
* Pin：创建控件约束，例如规定 UI control 的宽度
* Issues：解决对齐错误
* Resizing：说明尺寸如何影响约束

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-control.png)

除了右下角的菜单，苹果还制定了一个一种让开发者灵活的创建 Auto Layout 的方式：Control 键。你可以按住键盘上的 Control 键后点击鼠标，从一个视图拉到另一个上，这样便能创建两者的约束，此时你松开鼠标，就会出现一个可选的约束列表。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-control-drag.gif)

一旦你在一个 view 中创建了约束，在它上面将会出现一个橙色或者蓝色的约束线。橙色线代表存在不充足条件的约束，你需要去解决它。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-01-at-8.20.01-PM.png)

蓝色线则说明你的布局可以正确的显示，并不存在歧义。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-01-at-8.20.15-PM.png)

有时你创建一个约束之后，界面框上会有警告提醒。红色的箭头也说明布局有冲突或者歧义。点击提醒，可以看到一个错误的列表。这些问题按照一个个场景展示出来。典型的错误包括缺乏约束（missing constraints）、有歧义的约束（conflicting constraints）以及视图位置出错（misplaced views）。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-13-at-1.41.28-AM.png)

在 Size Inspector 中，你可以看到一些被添加过的约束，在“Constraints”的选项卡内。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-01-at-8.31.11-PM.png)

除了 size inspector 视图，这些约束也会在 Interface Builder Outline 下相应的出现。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-01-at-8.38.52-PM.png)


## Auto Layout 例子：居中按钮或图片

至此你应该对 Auto Layout 和如何设置约束有了一个比较基础的了解。现在重新回到一开始的例子，看看怎么居中一个按钮或者图片。

正如前面所说的，Auto Layout 是一个根据限制（constraint-based）来布局的方法。基于此，开发者可以创建一个自适应的界面来做到合适地在不同屏幕大小和旋转方向之间调整。好吧，听起来很牛逼，但「根据限制布局」究竟代表什么？我尝试用更平素的语言描述吧。回到我们的「Press Me」按钮，你怎么描述它的位置？可能会是：

不管屏幕尺寸如何，这个按钮都应该在垂直和水平坐标的中心。

现在你已经定义了两个约束（垂直居中和水平居中），这两个约束反映出标签和界面的布局。Auto Layout 的意义便在于约束。然而，约束是用精确的形式表现的。例如，如果你定义了一个按钮的位置，你可以会这么说：按钮的左边跟容器的左边应该相距 30 点。这等价于：button.left = (container.left + 30)

好了，这样便足以了解 Auto Layout 的概念了。

现在我们来看看怎么在屏幕中居中一个图片。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-14-at-12.31.17-PM.png)

假定你已经添加了一个 image view 并防止在视图中间，第一步要对它的宽和高做出约束。这里我将讲解怎么用 Auto Layout 的菜单。选择 image view 然后点击 Pin，选择 height 和 width，然后点击「Add 2 constraints」。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-size-constraints.jpg)

你可能发现到有红色警示出现在界面边框，这是提醒我们 image view 中存在约束问题。Xcode 可以帮助我们解决它们。点击红色警示，根据红色的指示最后点击「Add missing constraints」。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-14-at-11.20.44-AM.png)

好了，我们已经设置好约束。接着我们将设置一个居中的约束，这样即使用户旋转屏幕也能正常显示。先选择 image view 然后点击 Auto Layout 菜单的 Alignment 图标。在弹出的菜单中，选择「Vertical center in container」和「Horizontal center in container」选项，紧接着点击「Add Constraints」。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-13-at-1.04.19-PM.png)

现在你可以测试你的 app 了。编译并启动它，尝试在横屏竖屏中切换，可以看到 image view 始终保持在中间。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-example-image.jpg)

我们已经示范了怎么使用 Auto Layout 菜单来添加约束。你也可以用 Control 键实现一样的功能。下面来讲解它是怎么实现的。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-centre-button.gif)

## Auto Layout 例子：登录按钮

众所周知，iPhone 5 和 iPhone 4 是不一样尺寸的。这就需要一些微调来适应不同屏幕大小。思考一下下面的登录界面，登录的按钮被放置在视图的底部。如果你没有使用 Auto Layout，在 3.5 英寸的设备上将不会显示到登录按钮。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-login-compare.jpg)

那么要怎么解决这个问题？要解决这个问题，我们又回到之前的话题上，我们需要建立一个保证它放置在屏幕底部的约束。最重要的是，它的宽度也要随着旋转而改变。

首先我们需要为按钮高度添加一个大小的约束。只添加高度的约束即可，宽度则根据设备的方向改变。按住 Control 键鼠标点击按钮然后垂直的拖动一下，选择 height，通过添加这条约束解决掉 Interface Builder Outline 提示的歧义。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-14-at-1.00.07-PM.png)

为了保证按钮在设备处于不同方向的时候能与边缘保持相同的距离，我们需要添加另一个约束。按住 Control 键从按钮拖动到父视图的左边缘，选择「leading space to the container」。重复相同步骤到父视图的右边缘，选择「trailing space to the container」。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-login-trailing.gif)

最后一步需要添加一个让按钮保持在屏幕底部的约束。按住 Control 键从按钮拖动到它的父视图底部，选择「bottom space to bottom layout」。

![](http://www.appcoda.com/wp-content/uploads/2014/05/Screen-Shot-2014-06-14-at-1.02.02-PM.png)

好了，现在不同设备上运行你的 app。多亏了 Auto Layout，登录的按钮可以正常的在 3.5 英寸的 iPhone 上显示。当设备旋转的时候，按钮也会相应的拉长。

![](http://www.appcoda.com/wp-content/uploads/2014/07/auto-layout-login-landscape.jpg)

# what’s Coming Next
在这次教程中，我们介绍了使用 Interface Builder 的 Auto Layout 的基础。希望通过这次教程和例子能让你开始喜欢上 Auto Layout 。一旦你掌握了 Auto layout 的基础，它将表现出十分强大的实力。你可以创建自适应的 UI 以适应不同的屏幕大小。在进阶的教程中，我们将举出更多 Auto Layout 的例子，向你介绍怎么使用有规划的使用 Auto Layout。

你可以在这里下载 Xcode

如果你有什么想法或者建议，可以在下面和我留言分享。
























